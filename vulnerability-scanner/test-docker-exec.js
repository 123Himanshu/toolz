const { exec, spawn } = require('child_process');

console.log('Testing Docker execution from Node.js...\n');

// Test 1: Simple exec
console.log('Test 1: exec with -i flag');
exec('docker run --rm -i security-scanner python3 -c "print(123)"', (err, stdout, stderr) => {
  console.log('  stdout:', stdout.trim());
  console.log('  stderr:', stderr.trim());
  if (err) console.log('  error:', err.message);
  console.log('');
  
  // Test 2: exec without -i flag
  console.log('Test 2: exec without -i flag');
  exec('docker run --rm security-scanner python3 -c "print(456)"', (err2, stdout2, stderr2) => {
    console.log('  stdout:', stdout2.trim());
    console.log('  stderr:', stderr2.trim());
    if (err2) console.log('  error:', err2.message);
    console.log('');
    
    // Test 3: spawn with -i flag
    console.log('Test 3: spawn with -i flag');
    const child = spawn('docker', ['run', '--rm', '-i', 'security-scanner', 'python3', '-c', 'print(789)']);
    let out = '';
    let errOut = '';
    child.stdout.on('data', (data) => out += data);
    child.stderr.on('data', (data) => errOut += data);
    child.on('close', (code) => {
      console.log('  stdout:', out.trim());
      console.log('  stderr:', errOut.trim());
      console.log('  exit code:', code);
      console.log('');
      
      // Test 4: Full nmap command
      console.log('Test 4: Full nmap command with -i');
      exec('docker run --rm -i security-scanner python3 -c "from nmap_wrapper import NmapWrapper; print(\'nmap available:\', NmapWrapper.is_available())"', 
        { timeout: 30000 },
        (err3, stdout3, stderr3) => {
          console.log('  stdout:', stdout3.trim());
          console.log('  stderr:', stderr3.trim());
          if (err3) console.log('  error:', err3.message);
          console.log('\nDone!');
        }
      );
    });
  });
});
